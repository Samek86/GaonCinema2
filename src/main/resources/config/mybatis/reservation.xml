<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="reservation">
	
	<!-- 영화 이름, 관람가 가져오기(전체) -->
	<select id="selectMovieNameAgeAll" resultType="com.gaon.cinema.reservation.ReservationShowDTO">
		SELECT MOVIE_ID, NAME_K, AGE FROM GC_MOVIE
	</select>
	
	<!-- 영화 이름, 관람가 가져오기(도시 OR 지역 OR 날짜) -->
	<select id="selectMovieNameAge" resultType="com.gaon.cinema.reservation.ReservationShowDTO" parameterType="com.gaon.cinema.reservation.ReservationShowDTO">
		SELECT DISTINCT M.MOVIE_ID, M.NAME_K, M.AGE 
		FROM
			(SELECT * FROM GC_THEATER_SCHEDULE TS 
			INNER JOIN GC_THEATER T 
			ON TS.THEATER_ID = T.THEATER_ID) STS 
		INNER JOIN GC_MOVIE M 
		ON STS.MOVIE_ID = M.MOVIE_ID 
		WHERE STS.CNAME = #{cname} OR STS.LNAME = #{lname} OR TO_CHAR(STS.MSTARTHOUR, 'YYYY-MM-DD') = #{mstartdate}
	</select>
	
	<!-- 영화관 도시 가져오기(전체) -->
	<select id="selectTheaterCnameAll" resultType="com.gaon.cinema.reservation.ReservationShowDTO">
		SELECT DISTINCT CNAME, CORDER FROM GC_THEATER ORDER BY CORDER
	</select>
	
	<!-- 영화관 도시 가져오기(영화 OR 날짜) -->
	<select id="selectTheaterCname" resultType="com.gaon.cinema.reservation.ReservationShowDTO" parameterType="com.gaon.cinema.reservation.ReservationShowDTO">
		SELECT DISTINCT T.CNAME, T.CORDER 
		FROM GC_THEATER_SCHEDULE TS 
		INNER JOIN GC_THEATER T
		ON TS.THEATER_ID = T.THEATER_ID 
		WHERE TS.MOVIE_ID = #{movie_id} OR TO_CHAR(TS.MSTARTHOUR, 'YYYY-MM-DD') = #{mstartdate}
		ORDER BY T.CORDER
	</select>
	
	<!-- 영화관 지역 가져오기 -->
	<select id="selectTheaterLname" resultType="com.gaon.cinema.reservation.ReservationShowDTO" parameterType="String">
		SELECT DISTINCT T.LNAME 
		FROM GC_THEATER_SCHEDULE TS 
		INNER JOIN GC_THEATER T 
		ON TS.THEATER_ID = T.THEATER_ID
		WHERE CNAME = #{cname} 
		ORDER BY T.LNAME
	</select>
	
	<!-- 날짜 가져오기(전체) -->
	<select id="selectDateAll" resultType="com.gaon.cinema.reservation.ReservationShowDTO">
		SELECT DISTINCT TO_CHAR(MSTARTHOUR, 'YYYY-MM-DD') MSTARTDATE FROM GC_THEATER_SCHEDULE ORDER BY MSTARTDATE
	</select>
	
	<!-- 날짜 가져오기(영화 OR 도시 OR 지역) -->
	<select id="selectDate" resultType="com.gaon.cinema.reservation.ReservationShowDTO" parameterType="com.gaon.cinema.reservation.ReservationShowDTO">
		SELECT DISTINCT TO_CHAR(TS.MSTARTHOUR, 'YYYY-MM-DD') MSTARTDATE 
		FROM GC_THEATER_SCHEDULE TS 
		INNER JOIN GC_THEATER T 
		ON TS.THEATER_ID = T.THEATER_ID 
		WHERE TS.MOVIE_ID = #{movie_id} OR T.CNAME = #{cname} OR T.LNAME = #{lname} 
		ORDER BY MSTARTDATE
	</select>
	
	<!-- 시간 가져오기(영화 AND 도시 AND 지역 AND 날짜) -->
	<select id="selectHour" resultType="com.gaon.cinema.reservation.ReservationShowDTO" parameterType="com.gaon.cinema.reservation.ReservationShowDTO">
		SELECT T.TNAME, TO_CHAR(TS.MSTARTHOUR, 'HH24:MI') MSTARTHOUR 
		FROM GC_THEATER_SCHEDULE TS 
		INNER JOIN GC_THEATER T 
		ON TS.THEATER_ID = T.THEATER_ID 
		WHERE TS.MOVIE_ID = #{movie_id} AND T.CNAME = #{cname} 
		AND T.LNAME = #{lname} AND TO_CHAR(TS.MSTARTHOUR, 'YYYY-MM-DD') = #{mstartdate}
	</select>
	
</mapper>